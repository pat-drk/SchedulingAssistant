import{i as U,r as q,n as t,ag as k,I as F,s as ee,X as te,Y as ne,Z as O,$ as r,a0 as se,a1 as o,z as ae,t as i}from"./index-CWU0J6Yg.js";const re=U({root:{padding:i.spacingHorizontalM},controls:{display:"flex",alignItems:"end",gap:i.spacingHorizontalM,marginBottom:i.spacingVerticalM},spacer:{marginLeft:"auto"},tableWrapper:{overflow:"auto",maxHeight:"60vh",border:`1px solid ${i.colorNeutralStroke2}`,borderRadius:i.borderRadiusMedium},rowsText:{color:i.colorNeutralForeground3,marginTop:i.spacingVerticalXS}});function le({sqlDb:b,exportStart:_,exportEnd:f,setExportStart:R,setExportEnd:I,exportShifts:C,all:M,segmentTimesForDate:oe,segmentTimesForPersonDate:H,listTimeOffIntervals:W,subtractIntervals:S,groups:Y,people:L,roles:z}){const m=re();function u(e){return e<10?`0${e}`:`${e}`}function B(e){const s=e.getMonth()+1,l=e.getDate(),d=e.getFullYear();return`${s}/${l}/${d}`}function v(e){return`${u(e.getHours())}:${u(e.getMinutes())}`}function J(e){return`${e.getFullYear()}-${u(e.getMonth()+1)}-${u(e.getDate())}`}function y(e){const[s,l,d]=e.split("-").map(a=>parseInt(a,10));return new Date(s,l-1,d,0,0,0,0)}function X(e,s){return new Date(e.getTime()+s*6e4)}function P(e){switch(e.getDay()){case 1:return"Monday";case 2:return"Tuesday";case 3:return"Wednesday";case 4:return"Thursday";case 5:return"Friday";default:return"Weekend"}}const N=q.useMemo(()=>{if(!b)return[];const e=y(_),s=y(f);if(s<e)return[];const l=(c,j)=>{const[g,h]=j.split(":").map(Number);return new Date(c.getFullYear(),c.getMonth(),c.getDate(),g,h,0,0)},d=[];let a=new Date(e.getTime());for(;a<=s;){if(P(a)!=="Weekend"){const c=J(a),j=M(`SELECT de.title, de.start_time, de.end_time, g.name as group_name
             FROM department_event de
             LEFT JOIN grp g ON g.id = de.group_id
             WHERE de.date=?`,[c]),g=new Map;for(const n of j)g.set(n.title,{start_time:n.start_time,end_time:n.end_time,group_name:n.group_name??null});const h=M(`SELECT a.id, a.person_id, a.role_id, a.segment,
                  p.first_name, p.last_name, p.work_email,
                  r.name as role_name, r.code as role_code, r.group_id,
                  g.name as group_name
           FROM assignment a
           JOIN person p ON p.id=a.person_id
           JOIN role r ON r.id=a.role_id
           JOIN grp g  ON g.id=r.group_id
           WHERE a.date=?`,[c]),w=new Map;for(const n of h){const x=w.get(n.person_id)||[];x.push(n),w.set(n.person_id,x)}for(const n of h){const x=w.get(n.person_id)||[],V=H(a,x),p=g.get(n.segment),T=p?{start:l(a,p.start_time),end:l(a,p.end_time)}:V[n.segment];if(!T)continue;const A=p?n.segment:n.role_name;let G=[{start:T.start,end:T.end}],E=p?.group_name||n.group_name;const Z=W(n.person_id,a);for(const D of G){const K=S(D.start,D.end,Z);for(const $ of K)d.push({date:B(a),member:`${n.last_name}, ${n.first_name}`,email:n.work_email,group:E,start:v($.start),end:v($.end),label:A,color:Y.find(Q=>Q.name===E)?.theme||""})}}}a=X(a,24*60)}return d},[b,_,f,L.length,z.length]);return t.jsxs("div",{className:m.root,children:[t.jsxs("div",{className:m.controls,children:[t.jsx(k,{label:"Start",children:t.jsx(F,{type:"date",value:_,onChange:(e,s)=>R(s.value)})}),t.jsx(k,{label:"End",children:t.jsx(F,{type:"date",value:f,onChange:(e,s)=>I(s.value)})}),t.jsx("div",{className:m.spacer}),t.jsx(ee,{appearance:"primary",onClick:C,children:"Download XLSX"})]}),t.jsx("div",{className:m.tableWrapper,children:t.jsxs(te,{"aria-label":"Export preview table",children:[t.jsx(ne,{children:t.jsxs(O,{children:[t.jsx(r,{children:"Date"}),t.jsx(r,{children:"Member"}),t.jsx(r,{children:"Work Email"}),t.jsx(r,{children:"Group"}),t.jsx(r,{children:"Start"}),t.jsx(r,{children:"End"}),t.jsx(r,{children:"Custom Label"}),t.jsx(r,{children:"Theme"})]})}),t.jsx(se,{children:N.map((e,s)=>t.jsxs(O,{children:[t.jsx(o,{children:e.date}),t.jsx(o,{children:e.member}),t.jsx(o,{children:e.email}),t.jsx(o,{children:e.group}),t.jsx(o,{children:e.start}),t.jsx(o,{children:e.end}),t.jsx(o,{children:e.label}),t.jsx(o,{children:e.color})]},s))})]})}),t.jsxs(ae,{size:200,className:m.rowsText,children:["Rows: ",N.length]})]})}export{le as default};
